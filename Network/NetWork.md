# Network

1. ## 协议的概念和作用

   - 为了让计算机能够通信，计算机需要定义通信规则，这些规则就是协议
   - 规则是多种，协议也有多种
   - 协议就是数据封装格式+传输

   ### 1.1  服务+协议实现数据传输

   - 摩尔斯电码

2. ## OSI七层模型

   Open System Interconnection，适用于所有的网络

   - 分工带来效能

   - 将复杂的流程分解为几个功能相对单一的子进程

   - 整个流程更加清晰，复杂问题简单化

   - 更容易发现问题并针对性的解决问题

     - 应用层(Application) 提供网络与用户应用软件之间的接口服务
     - 表示层(Presentation) 提供格式化的表示和转换数据服务，如加密和压缩
     - 会话层(Session) 提供包括访问验证和会话管理在内的建立和维护应用之间通信的机制
     - 传输层(Transimission) 提供建立、维护和取消传输连接功能，负责可靠的传输数据(PC)
     - 网络层(Network) 处理网络间路由，确保数据及时传送(路由器)
     - 数据链路层(DataLink) 负责无错传输数据，确认帧、发错重传等(交换机)
     - 物理层(Physics) 提供机械、电气、功能和过程特性(网卡、网线、双绞线、同轴电缆、中继器)

     | 分层       | 功能                                           |
     | ---------- | ---------------------------------------------- |
     | 应用层     | 网络服务与最终用户的一个接口                   |
     | 表示层     | 数据的表示、安全、压缩                         |
     | 会话层     | 建立、管理、中止会话                           |
     | 传输层     | 定义传输数据的协议端口号，以及流控和差错校验   |
     | 网络层     | 进行逻辑地址寻址，实现不同网络之间的路径选择   |
     | 数据链路层 | 建立逻辑连接、进行硬件地址寻址、差错校验等功能 |
     | 物理层     | 建立、维护、断开物理连接                       |

     

3. ## TCP/IP参考模型

   - TCP/IP 是传输控制协议/网络互连协议的简称
   - 早期的 TCP/IP 模型是一个四层结构，从下往上依次是网络接口层、互联网层、传输层和应用层
   - 后来在使用过程中，借鉴OSI七层参考模型，将网络接口层划分为了物理层和数据链路层，形成五层结构

   ~~TCP/IP参考模型插图~~

   ### 常用协议

   - TCP/IP协议被称为传输控制协议/互联网协议，又称网络通讯协议
   - 是由网络层的IP协议和传输层的TCP协议组成，是一个很大的协议集合
   - 物理层和数据链路层没有定义任何特定协议，支持所有的标准和专用的协议
   - 网络层定义了网络互联也就是IP协议
     - 网际协议IP(Internet Protocal) 负责主机和网络之间寻址和路由数据包
     - 地址解析协议ARP(Address Resolution Protocol) 获得同一物理网络中的硬件主机MAC地址
     - 反向地址转换协议(Reverse Address Resoltion Protocol) 允许局域网的物理机器从网关服务器的ARP表或者缓存上请求其IP地址
     - 网际控制消息协议ICMP(Internet Control Message Protocol) 发送消息，并报告有关数据包的传送错误
     - 互联组管理协议IGMP(Internet Group Management Protocol) IP主机向本地多路广播路由器报告主机组成员
   - 传输层定义了TCP(传输控制协议)和UDP(用户数据报)协议
   - 应用层定义了HTTP(超文本传输协议)、FTP(文件传输协议)、DNS(域名系统)等协议

   ~~插图TCP/IP协议族组成~~

   [参考：OSI协议簇](https://zhuanlan.zhihu.com/p/26328189)

   ### 3.1 网络接口层

   网络接口层是 TCP/IP 模型的最底层，负责接收从上一层交来的数据报并将数据报通过底层的物理网络发送出去，比较常见的就是设备的驱动程序，此层没有特定的协议 网络接口层又分为物理层和数据链路层

   #### 3.1.1 物理层

   计算机在传递数据的时候传递的都是0和1的数字，而物理层关心的是用什么信号来表示0和1，是否可以双向通信，最初的连接如何建立以及完成连接如何终止，物理层是为数据传输提供可靠的环境。

   - 为数据端设备提供传送数据的通路

   - 传输数据

     - 激活物理连接，在连接的设备之间连接起来形成通路
     - 传输数据，关心如何打包数据和控制传输速度
     - 关闭物理连接

     ~~插图 物理层.jpg~~

   #### 3.1.2 数据链路层

   数据链路层属于物理层和互联网层之间，用来向网络层提供数据，就是把源计算机网络层传过来的信息传递给目标主机

   - 如何将数据组合成数据帧(Frame)，帧是数据链路层的传输单位
   - 数据链路的建立、维护和拆除
   - 帧包装、帧传输、帧同步
   - 帧的差错恢复
   - 流浪控制

   #### 3.1.3 MAC地址

   - 在通信过程中是用内置在网卡内的地址来标识计算机身份的
   - 每个网卡都有一个全球唯一的地址来标识自己，不会重复
   - MAC地址48位的二进制组成，通常分为6段，用16进制标识

   ~~插图 MAC地址.jpg~~

   ### 3.2 互联网层(网络层)

   - 位于传输层和网络接口层之间，用于把数据从源主机经过若干个中间节点传送到目标主机，并向传输层提供最基础的数据传输服务，它要提供路由和选址的工作

   ~~插图 网络层.jpg~~

   #### 3.2.1 选址

   交互机是靠 MAC 来寻址的，而因为 MAC 地址是无层次的，所以要靠 IP 地址来确认计算机的位置，这就是选址
   ~~插图 选址~~

   #### 3.2.2 路由

   在能够选择的多条道路之间选择一条最短的路径就是路由的工作
   ~~插图 路由~~

   #### 3.2.3 IP

   在网络中，每台计算机都有一个唯一的地址，方便别人找到它，这个地址称为IP地址

   ##### 3.2.3.1 IP头部

   ~~插图 IP头部~~

   - 版本
   - 首部长度
   - 优先级与服务类型
   - 总长度 该字段用以指示整个IP数据包的长度，最长为 65535 字节，包括头和数据
   - 标识符 唯一标识主机发送的每一份数据报
   - 标志 分为3个字段，依次为保留位、不分片位和更多片位
     - 保留位：一般被置为0
     - 不分片位：标识该数据报是否被分片，如果被置为1，则不能对数据报进行分片，如果要对其进行分片处理，就应将其置为0
     - 更多片位：除了最后一个分片，其他每个组成数据报的片都要将该位置设置为1
   - 段偏移量 该分片相对于原始数据报开始处位置的偏移量
   - TTL(Time to Live生存时间) 该字段用于表示IP数据包的生命周期，可以防止一个数据包在网络中无限循环地发下去。TTL的意思是一个数据包在被丢弃之前在网络中的最大周转时间。该数据包经过的每一个路由器都会检查该字段中的值，当TTL的值为0时，此数据包会被丢弃。TTL对应于一个数据包通过路由器的数目，一个数据包每经过一个路由器，TTL将减去1
   - 协议号 用以指示IP数据包中封装的是那个协议
   - 首部校验和 检验和是16位的错误检测字段。目的主机和网络中的每个网关都要重新计算报头和校验和，一样表示没有改动过
   - 源IP地址 该字段用于表示数据包的源地址，指的是发送该数据包的设备的网络地址
   - 目标IP地址 该字段用于表示数据包的目标地址，指的是接收节点的网络地址

   ##### 3.2.3.2 IP地址格式

   - IP地址是一个网络编码，用来确定网络中的一个节点。
   - IP地址是由32位二进制(32bit)组成

   ~~插图 IP地址格式~~

   ##### 3.2.3.3 IP地址组成

   - 网络部分(NETWORK)
   - 主机部分(HOST)

   ~~插图 IP地址组成~~

   ##### 3.2.3.4 IP地址表示

   ~~插图 IP地址表示~~

   ##### 3.2.3.5 IP地址的分类

   - IP地址的网络部分是由 Internet 地址分配机构来统一分配的，这样可以保证 IP 的唯一性
   - ip 地址中全为 1 的 ip 即 255.255.255.255，它称为限制广播地址，如果将其作为数据包的目标地址可以理解为发送到所有网络的所有主机
   - ip 地址中全为 0 的 ip 即 0.0.0.0，它表示启动时的 ip 地址，其含义就是尚未未分配时的 ip 地址
   - 127 是用来进行本机测试的，除了 127.255.255.255 外，其他的 127 开头的地址都代表本机

   ~~插图 IP地址分类~~

   ##### 3.2.3.6 公有地址和私有地址

   私有IP

   - A类私有IP：10.0.0.0 ~ 10.255.255.255
   - B类私有IP：172.16.0.0 ~ 172.31.255.255
   - C类私有IP：192.168.0.0 ~ 192.168.255.255

   其他范围的IP均为公有IP地址

   ##### 3.2.3.7 子网掩码

   子网掩码(subnet mask)又叫子网络遮罩，它是一种用来指明一个IP地址的那些位标识的是主机所在的子网，以及那些位标识的是主机位的掩码。子网掩码不能单独存在，它必须结合IP地址一起使用。子网掩码只有一个作用，就是将某个IP地址划分成网络地址和主机地址两部分。

   - 子网掩码也是32个二进制位
   - 对应IP的网络部分用1表示
   - 对应IP地址的主机部分用0表示
   - IP地址和子网掩码做逻辑与运算得到网络地址
     - 0和任何数相与都是0
     - 1和任何数相与都等于任何数本身
   - A B C 三类地址都有自己默认的子网掩码
     - A类 255.0.0.0
     - B类 255.255.0.0
     - C类 255.255.255.0

   

   ~~插图  子网掩码~~

   

   ### 3.3 传输层

   位于应用层和网络接口层之间

   - 是面向连接的、可靠的的进程到进程通信的协议
   - TCP提供全双工服务，即数据可在同一时间双向传播
   - TCP将若干个字节构成一个分组，此分组称为报文段(Segment)

   ~~插图 传输层概述~~

   #### 3.3.1 传输层的功能

   提供了一种端到端的连接

   ~~插图 传输层功能~~

   #### 3.3.2 对可靠性要求高的上层协议，实现可靠性的保证

   - 如果数据丢失、损坏的情况下如何保证可靠性
   - 网络层只管传递数据，成功与否并不关心

   #### 3.3.3 协议分类

   - TCP (Transimision Control Protocal)
     - 传输控制协议
     - 可靠的、面向连接的协议
     - 传输效率低
   - UDP (User Datagram Protocal)
     - 用户数据报协议
     - 不可靠的、无连接的服务
     - 传输效率高

   #### 3.3.4 TCP功能

   - 将数据进行分段打包传输
   - 对每个数据包编号控制顺序
   - 运输中丢失、重发和丢弃处理
   - 流量控制避免拥塞

   ##### 3.3.4.1 TCP数据包封装

   ~~插图 TCP数据包封装~~

   - 源端口号和目标端口号，计算机通过端口号识别访问那个服务，比如http服务或ftp服务，发送方端口号是进行随机端口，目标端口号决定了接收方那个程序来接收
     ~~插图 TCP数据包封装1~~
   - 32位序列号 TCP用序列号对数据包进行标记，以便在到达目的地后重新重装，假设当前的序列号为 s，发送数据长度为 l，则下次发送数据时的序列号为 s + l。在建立连接时通常由计算机生成一个随机数作为序列号的初始值

   ##### 3.3.4.2 握手和断开

   





[参考：Node进阶 --- Network (一)](https://www.jianshu.com/p/d7e8755d2a9c?utm_campaign=maleskine&utm_content=note&utm_medium=seo_notes&utm_source=recommendation)

